<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Player</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    background-color: #111;
    color: #fff;
  }
  #sidebar {
    width: 250px;
    background-color: #1a1a1a;
    overflow-y: auto;
    border-right: 1px solid #333;
  }
  #sidebar h2 {
    text-align: center;
    padding: 10px 0;
    border-bottom: 1px solid #333;
    margin: 0;
  }
  #channel-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #channel-list li {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #333;
  }
  #channel-list li:hover, #channel-list li.active {
    background-color: #333;
  }

  #player-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    background-color: black;
  }

  video {
    width: 100%;
    max-width: 100%;
    aspect-ratio: 16/9;
    border-radius: 8px;
    background-color: black;
  }

  #fullscreen-btn {
    position: absolute;
    bottom: 15px;
    right: 15px;
    background-color: rgba(0,0,0,0.5);
    color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
  }

  #fullscreen-btn:hover {
    background-color: rgba(255,255,255,0.2);
  }

  @media (max-width: 768px) {
    body {
      flex-direction: column;
    }
    #sidebar {
      width: 100%;
      height: 150px;
      display: flex;
      overflow-x: auto;
      overflow-y: hidden;
      border-right: none;
      border-bottom: 1px solid #333;
    }
    #channel-list {
      display: flex;
      flex-direction: row;
    }
    #channel-list li {
      min-width: 120px;
      border-bottom: none;
      border-right: 1px solid #333;
    }
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Channels</h2>
  <ul id="channel-list"></ul>
</div>

<div id="player-container">
  <video id="hls-player" controls autoplay></video>
  <button id="fullscreen-btn">Fullscreen</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video = document.getElementById('hls-player');
const channelListEl = document.getElementById('channel-list');
const fullscreenBtn = document.getElementById('fullscreen-btn');
const playlistUrl = 'https://pabbhi.github.io/prdigitv/tv1.m3u'; // Replace with your .m3u file

let channels = [];
let hls;

fetch(playlistUrl)
  .then(res => res.text())
  .then(data => {
    const lines = data.split('\n');
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].startsWith('#EXTINF:')) {
        const name = lines[i].split(',')[1] || 'Unnamed Channel';
        const url = lines[i + 1]?.trim();
        if (url) channels.push({ name, url });
      }
    }
    populateChannelList();
    if (channels.length > 0) playChannel(0); // autoplay first channel
  });

function populateChannelList() {
  channelListEl.innerHTML = '';
  channels.forEach((ch, idx) => {
    const li = document.createElement('li');
    li.textContent = ch.name;
    li.addEventListener('click', () => playChannel(idx));
    channelListEl.appendChild(li);
  });
}

function playChannel(idx) {
  const selectedChannel = channels[idx];
  if (!selectedChannel) return;

  // Highlight active channel
  Array.from(channelListEl.children).forEach((li, i) => {
    li.classList.toggle('active', i === idx);
  });

  // Destroy previous hls instance if exists
  if (hls) {
    hls.destroy();
    hls = null;
  }

  if (Hls.isSupported()) {
    hls = new Hls({ capLevelToPlayerSize: true });
    hls.loadSource(selectedChannel.url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = selectedChannel.url;
    video.play();
  } else {
    alert('Your browser does not support HLS streaming.');
  }
}

// Fullscreen button
fullscreenBtn.addEventListener('click', () => {
  if (video.requestFullscreen) video.requestFullscreen();
  else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen();
  else if (video.msRequestFullscreen) video.msRequestFullscreen();
});
</script>

</body>
</html>
